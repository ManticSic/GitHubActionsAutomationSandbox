name: Build Nightly

on:
  repository_dispatch:
  push:
    types: build-nightly
  schedule:
    - cron:  '*/60 * * * *'

jobs:
  build:
    name: Run nightly build
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v1
        with:
          ref: 'master'
      
      - name: Checkout master
        run: git checkout master
        
      - name: Precondition
        run: .\build\precodition.ps1

      - name: Build
        if: success()
        run: .\build\build.ps1
      
      - name: Pack
        if: success()
        run: .\build\pack.ps1
      
      #- name: Tag
      #  if: success()
      #  run: .\build\tag.ps1

      - name: Update nightly-rev
        if: success()
        run: .\build\update-nightly-rev.ps1
      
      - name: Increment Version
        if: success()
        run: .\build\increment-version.ps1

      - name: Add & Commit
        if: success()
        run: git commit -a -m "Commit Message" -author="GitHub Actions<actions@github.com>"
